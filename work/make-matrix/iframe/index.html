<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
</head>

<body style="margin: 0; overflow: hidden; background-color: #0D200D;">
    <a href="https://github.com/neefrehman/make-matrix" target="_blank" rel="noreferrer noopener" style="width: 100%; height: 100%; position: fixed;"> </a>
    <script src="../../generative/iframe/p5.min.js"> </script>
    <script>

        function makeMatrix(dimensions, initialValues) {
            if (initialValues === void 0) {
                initialValues = null;
            }
            var currentDimensionWidth;
            var remainingDimensions;
            var needsRecursion;
            if (typeof dimensions === "number") {
                currentDimensionWidth = dimensions;
                remainingDimensions = dimensions - 1;
                needsRecursion = remainingDimensions > 0;
            } else {
                currentDimensionWidth = dimensions[0];
                remainingDimensions = dimensions.slice(1);
                needsRecursion = remainingDimensions.length > 0;
            }
            var currentMatrix = Array(currentDimensionWidth).fill(initialValues);
            var finalMatrix = needsRecursion
                ? currentMatrix.map(function () {
                    return makeMatrix(remainingDimensions, initialValues);
                })
                : currentMatrix;
            return finalMatrix;
        }



        let longestDimension;
    let res;
    let grid;

    let numColumns;
    let numRows;

    let camZStart;
    let camZ;

    let camXOff = 0;
    let camYOff = 0;

    const forceOdd = (number) => {
        return number % 2 !== 0 ? number : number - 1;
    };

    setup = () => {
        createCanvas(windowWidth, windowHeight, WEBGL);
        stroke(181, 105, 25);
        strokeWeight(2);

        longestDimension = Math.max(width, height);
        res = longestDimension * 0.1;

        numColumns = forceOdd(Math.ceil(width / res));
        numRows = 2;

        grid = makeMatrix([numColumns + 1, numRows, numColumns]);

        camZStart = width > 800 ? (-res * numColumns) / 2 : 0;
        camZ = camZStart;
    };

    draw = () => {
        background(21, 12, 53);
        camZ = camZ >= camZStart + res ? camZStart : camZ + 0.25;
        translate((-numColumns * res) / 2, -res / 2, camZ);
        rotateX(camXOff);
        rotateY(camYOff);

        grid.forEach((column, x) => {
            column.forEach((row, y) => {
                row.forEach((depth, z) => {
                    const curX = x * res;
                    const curY = y * res;
                    const curZ = z * res;

                    const fogIntensity = map(z, 0, row.length, 20, 255);
                    stroke(220, 175, 225, fogIntensity);

                    if (x !== row.length) {
                        line(curX, curY, curZ, curX + res, curY, curZ);
                    }
                    line(curX, curY, curZ, curX, curY, curZ + res);
                });
            });
        });
    };

    mouseMoved = () => {
        const mappedMouseY = map(mouseY, 0, height, -0.02, 0.02);
        const mappedMouseX = map(mouseX, 0, width, -0.02, 0.02);
        camXOff = lerp(camXOff, mappedMouseY, 0.5);
        camYOff = lerp(camYOff, mappedMouseX, 0.5);
    };
        
        windowResized = () => resizeCanvas(windowWidth, windowHeight);

    </script>
</body>
</html>